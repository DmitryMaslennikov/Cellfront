const a0_0x2295d9=a0_0x29ce;(function(_0x1d2dba,_0x5d0bd1){const _0x46385e=a0_0x29ce,_0x3518c1=_0x1d2dba();while(!![]){try{const _0x3b2a3f=-parseInt(_0x46385e(0xcf))/0x1*(parseInt(_0x46385e(0xcd))/0x2)+parseInt(_0x46385e(0xaa))/0x3+parseInt(_0x46385e(0xa5))/0x4*(-parseInt(_0x46385e(0xc5))/0x5)+parseInt(_0x46385e(0x96))/0x6*(parseInt(_0x46385e(0x92))/0x7)+parseInt(_0x46385e(0xc2))/0x8+-parseInt(_0x46385e(0xb9))/0x9*(-parseInt(_0x46385e(0xbc))/0xa)+parseInt(_0x46385e(0xce))/0xb;if(_0x3b2a3f===_0x5d0bd1)break;else _0x3518c1['push'](_0x3518c1['shift']());}catch(_0x4e5094){_0x3518c1['push'](_0x3518c1['shift']());}}}(a0_0xff07,0x62e71));import{GameState}from'./gameState.js';function a0_0xff07(){const _0x206924=['grid','pow','playerRein','placements','random','max','rein_enemy_3','rein_player_3','8XTsPOO','min','enemy','enemyRein','rein_player_1','448617wecHTL','tickCount','calcEnemies','reinforcements','floor','rein_player_2','sin','rules','gridSize','player','nextSoundEvent','log2','killed','breath','ceil','217944Vrqkjh','phase','countUnits','50iLUbys','stop','reset','startGameLoop','cols','calcSum','2421752nNbNly','incomeE','resources','1201000xmQkYN','speed','opp_killed','lastReinforcementPower','rein_enemy_2','deaths','onGameOver','running','412kGwZhw','3900358AJCYCQ','2579cPIchd','onSound','startPhase','canPlace','difficulty','nextSoundEvent2','incomeP','now','onTick','initGrid','tick','get','rows','7cDJGBa','births','RANDOM_RATIO','rein_enemy_1','2933178cTjsgU','setupAnimations','reinInfo','sqrt','getWinner','state','game-state'];a0_0xff07=function(){return _0x206924;};return a0_0xff07();}function a0_0x29ce(_0x4f632e,_0x3abdd7){const _0xff07dc=a0_0xff07();return a0_0x29ce=function(_0x29ce5c,_0x2d7479){_0x29ce5c=_0x29ce5c-0x88;let _0x12ec41=_0xff07dc[_0x29ce5c];return _0x12ec41;},a0_0x29ce(_0x4f632e,_0x3abdd7);}import{tryPlaceAI}from'./ai.js';import{saveData}from'./persistence.js';export class GameEngine{constructor(_0x99351c,_0x34f4d8,{onTick:onTick=()=>{},onGameOver:onGameOver=()=>{},onSound:onSound=()=>{}}={}){const _0x5bfce6=a0_0x29ce;this['state']=new GameState(_0x99351c,_0x34f4d8),this['births']={},this['deaths']={},this['placements']={},this[_0x5bfce6(0xb6)]={},this['lastReinforcementPower']=0x0,this['onTick']=onTick,this[_0x5bfce6(0xcb)]=onGameOver,this[_0x5bfce6(0xd0)]=onSound;}['setParameters'](_0x542da0){const _0x5b8e8e=a0_0x29ce;this[_0x5b8e8e(0x9b)]['difficulty']=_0x542da0[_0x5b8e8e(0x89)],this[_0x5b8e8e(0x9b)]['breath']=_0x542da0['breath'],this['state'][_0x5b8e8e(0xad)]=_0x542da0[_0x5b8e8e(0xad)];}[a0_0x2295d9(0x8e)](){const _0x35958e=a0_0x2295d9;this[_0x35958e(0x9b)][_0x35958e(0xbe)]();const {rows:_0x1c17de,cols:_0x4e486a}=this['state'][_0x35958e(0xb2)];for(let _0x3b5429=0x0;_0x3b5429<0x9&&_0x3b5429<_0x1c17de;_0x3b5429++)for(let _0x2dfebe=_0x4e486a-0x9;_0x2dfebe<_0x4e486a;_0x2dfebe++)Math[_0x35958e(0xa1)]()<0.5&&(this[_0x35958e(0x9b)][_0x35958e(0x9d)][_0x3b5429][_0x2dfebe]=0x1,this[_0x35958e(0x9b)]['grid'][_0x1c17de-_0x3b5429-0x1][_0x4e486a-_0x2dfebe-0x1]=-0x1);}[a0_0x2295d9(0x97)](){const _0x3e46e6=a0_0x2295d9;this[_0x3e46e6(0x93)]={},this[_0x3e46e6(0xca)]={},this[_0x3e46e6(0xa0)]={};}['updateRandomCells'](){const _0x3b6e6e=a0_0x2295d9,{rows:_0x8180df,cols:_0x2a664c}=this[_0x3b6e6e(0x9b)][_0x3b6e6e(0xb2)];let _0x3473ca=Math['floor'](_0x8180df*_0x2a664c*this['state'][_0x3b6e6e(0x94)]*this[_0x3b6e6e(0x9b)][_0x3b6e6e(0xc6)]+Math[_0x3b6e6e(0xa1)]());for(;_0x3473ca--;){const _0x2a7e20=Math['floor'](Math[_0x3b6e6e(0xa1)]()*_0x8180df),_0xfbdf=Math[_0x3b6e6e(0xae)](Math[_0x3b6e6e(0xa1)]()*_0x2a664c),_0x17542c=this[_0x3b6e6e(0x9b)]['grid'][_0x2a7e20][_0xfbdf],_0x1f25e4=_0x17542c+','+this[_0x3b6e6e(0xc1)](_0x2a7e20,_0xfbdf),_0x1004b4=this[_0x3b6e6e(0x9b)][_0x3b6e6e(0xb1)][_0x3b6e6e(0x90)](_0x1f25e4)||0x0,_0x2daf52=Math[_0x3b6e6e(0xae)](Math[_0x3b6e6e(0xa1)]()+_0x1004b4);this['state'][_0x3b6e6e(0x9d)][_0x2a7e20][_0xfbdf]=_0x2daf52;const _0x5edaa9=this[_0x3b6e6e(0x9b)][_0x3b6e6e(0xab)];0x0!==_0x17542c&&0x0===_0x2daf52&&(this[_0x3b6e6e(0xca)][_0x2a7e20+','+_0xfbdf]=_0x5edaa9,!this[_0x3b6e6e(0xb4)]&&this[_0x3b6e6e(0xac)](_0x17542c,_0x2a7e20,_0xfbdf)>0x0&&(this[_0x3b6e6e(0xb4)]=_0x17542c>0x0?'death_nearby':_0x3b6e6e(0xc7))),0x0===_0x17542c&&0x0!==_0x2daf52&&(this[_0x3b6e6e(0x93)][_0x2a7e20+','+_0xfbdf]=_0x5edaa9);}}['recalcResources'](){const _0x2a0b6c=a0_0x2295d9,{rows:_0x362f79}=this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xb2)],{player:_0x1b23e4,enemy:_0x415dc5}=this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xbb)](),_0x36e4c9=Math[_0x2a0b6c(0xb0)](this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xba)]),_0x59bcfb=0x1+this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xb7)]*_0x36e4c9,_0x2d6326=0x1-this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xb7)]*_0x36e4c9,_0x47f800=0.025*Math[_0x2a0b6c(0x9e)](_0x1b23e4,0.25)*Math[_0x2a0b6c(0x99)](_0x362f79)/(0x1+this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xad)]),_0x46491b=0.025*Math[_0x2a0b6c(0x9e)](_0x415dc5,0.25)*Math[_0x2a0b6c(0x99)](_0x362f79)/(0x1+this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xad)]),_0x5dd590=0x14*this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xc6)]/0x3e8;this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xc4)][_0x2a0b6c(0x8b)]=_0x47f800*_0x59bcfb,this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xc4)][_0x2a0b6c(0xc3)]=_0x46491b*_0x2d6326*this[_0x2a0b6c(0x9b)]['difficulty'];const _0x198c9d=Math['max'](Math['min'](this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xab)],0xa*_0x362f79*this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xab)]**0.5),0xfa0),_0x743b9d=this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xad)],_0x3e600b=0x96*this[_0x2a0b6c(0x9b)][_0x2a0b6c(0x9f)]/_0x198c9d,_0x51518d=0x96*this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xa8)]/_0x198c9d;this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xc4)][_0x2a0b6c(0x8b)]+=_0x3e600b,this[_0x2a0b6c(0x9b)]['resources'][_0x2a0b6c(0xc3)]+=_0x51518d,this[_0x2a0b6c(0x9b)][_0x2a0b6c(0x9f)]-=0x96*this[_0x2a0b6c(0x9b)]['playerRein']/_0x198c9d*_0x5dd590,this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xa8)]-=0x96*this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xa8)]/_0x198c9d*_0x5dd590,this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xc4)][_0x2a0b6c(0xb3)]+=this['state'][_0x2a0b6c(0xc4)]['incomeP']*_0x5dd590,this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xc4)][_0x2a0b6c(0xa7)]+=this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xc4)][_0x2a0b6c(0xc3)]*_0x5dd590,this[_0x2a0b6c(0xc8)]*=0x1-_0x5dd590;const _0x47f5a2=0.5*_0x3e600b+_0x47f800,_0x551d1f=_0x51518d/(0.000001+this[_0x2a0b6c(0x9b)]['difficulty'])*0.5+_0x46491b;let _0x438210=Math[_0x2a0b6c(0xa2)](this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xc4)][_0x2a0b6c(0xb3)]+_0x1b23e4-this[_0x2a0b6c(0x9b)]['resources'][_0x2a0b6c(0xa7)],0x1),_0x2040fe=Math[_0x2a0b6c(0xa2)](this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xc4)][_0x2a0b6c(0xa7)]+_0x415dc5-this[_0x2a0b6c(0x9b)][_0x2a0b6c(0xc4)][_0x2a0b6c(0xb3)],0x1),_0x1db13e=Math[_0x2a0b6c(0xa2)](_0x438210+0.5*this[_0x2a0b6c(0x9b)][_0x2a0b6c(0x9f)],0x1),_0xea878c=Math[_0x2a0b6c(0xa2)](_0x2040fe+0.5*this['state'][_0x2a0b6c(0xa8)],0x1);const _0x4c006f=Math[_0x2a0b6c(0xa6)](Math[_0x2a0b6c(0xa2)](0x1,_0x438210/_0xea878c/0x2,_0x2040fe/0x2/_0x1db13e),0x10),_0x38d251=0.5/(0.02*_0x198c9d)*_0x743b9d**0.5*_0x4c006f**0.5,_0x44a330=Math[_0x2a0b6c(0xa2)](_0x551d1f-0x0*_0x47f5a2,0x0)/_0x38d251*_0x743b9d**0.5*_0x4c006f**0.2,_0x316a46=Math[_0x2a0b6c(0xa2)](_0x47f5a2-0x0*_0x551d1f,0x0)*this[_0x2a0b6c(0x9b)][_0x2a0b6c(0x89)]/_0x38d251*_0x743b9d**0.5*_0x4c006f**0.2;if(this[_0x2a0b6c(0x9b)][_0x2a0b6c(0x98)]={'reinSecond':_0x38d251,'playerReinSize':_0x44a330,'enemyReinSize':_0x316a46},Math[_0x2a0b6c(0xa1)]()<_0x38d251*_0x5dd590){let _0x79a280=_0x44a330;this[_0x2a0b6c(0x9b)]['playerRein']+=_0x79a280,this['lastReinforcementPower']+=_0x79a280,_0x79a280>=0.5*_0x362f79&&(this[_0x2a0b6c(0x8a)]=_0x79a280<1.5*_0x362f79?_0x2a0b6c(0xa9):_0x79a280<0x5*_0x362f79?_0x2a0b6c(0xaf):_0x2a0b6c(0xa4));}if(Math[_0x2a0b6c(0xa1)]()<_0x38d251*_0x5dd590){let _0x16013b=_0x316a46;this[_0x2a0b6c(0x9b)]['enemyRein']+=_0x16013b,this['lastReinforcementPower']-=_0x16013b,_0x16013b>=0.5*_0x362f79&&(this[_0x2a0b6c(0x8a)]=_0x16013b<1.5*_0x362f79?_0x2a0b6c(0x95):_0x16013b<0x5*_0x362f79?_0x2a0b6c(0xc9):_0x2a0b6c(0xa3));}}[a0_0x2295d9(0x8f)](){const _0x52a6c7=a0_0x2295d9;if(this[_0x52a6c7(0x9b)][_0x52a6c7(0xab)]+=this[_0x52a6c7(0x9b)][_0x52a6c7(0xc6)],this[_0x52a6c7(0x9b)][_0x52a6c7(0xba)]=this[_0x52a6c7(0x9b)][_0x52a6c7(0xd1)]+3.14*Math[_0x52a6c7(0xb5)](0x64+this['state']['tickCount']),this['updateRandomCells'](),this['recalcResources'](),0x0==Math['floor'](this[_0x52a6c7(0x9b)][_0x52a6c7(0xab)]%0x4/this[_0x52a6c7(0x9b)][_0x52a6c7(0xc6)]))for(let _0x11e774=0x0;_0x11e774<Math[_0x52a6c7(0xb8)](this[_0x52a6c7(0x9b)][_0x52a6c7(0xc6)]/0x4);_0x11e774++){const _0x1b0d49=tryPlaceAI(this[_0x52a6c7(0x9b)]);_0x1b0d49&&(this[_0x52a6c7(0x9b)]['grid'][_0x1b0d49['r']][_0x1b0d49['c']]=-0x1,this[_0x52a6c7(0xa0)][_0x1b0d49['r']+','+_0x1b0d49['c']]={'time':this[_0x52a6c7(0x9b)][_0x52a6c7(0xab)],'type':_0x52a6c7(0xa7)},this['state'][_0x52a6c7(0xc4)][_0x52a6c7(0xa7)]--,this['nextSoundEvent']='enemy_place');}0x0==Math[_0x52a6c7(0xae)](this['state']['tickCount']%0x14/this['state'][_0x52a6c7(0xc6)])&&saveData(this[_0x52a6c7(0x9b)],_0x52a6c7(0x9c)),this[_0x52a6c7(0x8d)](this[_0x52a6c7(0x9b)],{'births':this[_0x52a6c7(0x93)],'deaths':this[_0x52a6c7(0xca)],'placements':this[_0x52a6c7(0xa0)]});}[a0_0x2295d9(0xbf)](){const _0x36ca73=a0_0x2295d9;this[_0x36ca73(0x9b)][_0x36ca73(0xcc)]=!0x0;const _0x22054c=()=>{const _0x1d512c=_0x36ca73;if(!this[_0x1d512c(0x9b)][_0x1d512c(0xcc)])return;const _0x15006a=performance[_0x1d512c(0x8c)]();this[_0x1d512c(0x9b)][_0x1d512c(0xc6)]>0x0&&this[_0x1d512c(0x8f)]();const _0xb3bb79=performance[_0x1d512c(0x8c)]()-_0x15006a;setTimeout(_0x22054c,Math[_0x1d512c(0xa2)](0x0,0x14-_0xb3bb79));};_0x22054c();}[a0_0x2295d9(0xbd)](){const _0x3914e3=a0_0x2295d9;this[_0x3914e3(0x9b)][_0x3914e3(0xcc)]=!0x1;}[a0_0x2295d9(0x9a)](){const _0x3d94e6=a0_0x2295d9,{player:_0x373e94,enemy:_0x59d2c9}=this[_0x3d94e6(0x9b)][_0x3d94e6(0xbb)]();return 0x0===_0x373e94?'enemy':0x0===_0x59d2c9?'player':null;}['calcSum'](_0x27c706,_0xe0b5e6){const _0x1e9ea8=a0_0x2295d9;let _0x2c5e38=0x0;for(let _0x5ca95a=-0x1;_0x5ca95a<=0x1;_0x5ca95a++)for(let _0x30a04d=-0x1;_0x30a04d<=0x1;_0x30a04d++)if(_0x5ca95a||_0x30a04d){const _0x39090a=_0x27c706+_0x5ca95a,_0x27ad3f=_0xe0b5e6+_0x30a04d;_0x39090a>=0x0&&_0x39090a<this['state'][_0x1e9ea8(0xb2)][_0x1e9ea8(0x91)]&&_0x27ad3f>=0x0&&_0x27ad3f<this['state'][_0x1e9ea8(0xb2)]['cols']&&(_0x2c5e38+=this[_0x1e9ea8(0x9b)]['grid'][_0x39090a][_0x27ad3f]);}return _0x2c5e38;}[a0_0x2295d9(0xac)](_0x376729,_0x3a95a5,_0x2fb681){const _0x2fed37=a0_0x2295d9;let _0x48d146=0x0;for(let _0x4a0a77=-0x1;_0x4a0a77<=0x1;_0x4a0a77++)for(let _0xd6e0f5=-0x1;_0xd6e0f5<=0x1;_0xd6e0f5++)if(_0x4a0a77||_0xd6e0f5){const _0x2785b5=_0x3a95a5+_0x4a0a77,_0x55c781=_0x2fb681+_0xd6e0f5;if(_0x2785b5>=0x0&&_0x2785b5<this[_0x2fed37(0x9b)][_0x2fed37(0xb2)][_0x2fed37(0x91)]&&_0x55c781>=0x0&&_0x55c781<this[_0x2fed37(0x9b)][_0x2fed37(0xb2)][_0x2fed37(0xc0)]){const _0x509700=this['state'][_0x2fed37(0x9d)][_0x2785b5][_0x55c781];_0x48d146+=_0x376729*_0x509700<0x0?-_0x376729*_0x509700:0x0;}}return _0x48d146;}[a0_0x2295d9(0x88)](_0x2474ab,_0x27b135,_0x22c335){const _0x228f8c=a0_0x2295d9,_0x4e429e=_0x2474ab>0x0?this[_0x228f8c(0x9b)][_0x228f8c(0xc4)][_0x228f8c(0xb3)]:this[_0x228f8c(0x9b)][_0x228f8c(0xc4)][_0x228f8c(0xa7)];return _0x27b135>=0x0&&_0x27b135<this[_0x228f8c(0x9b)]['gridSize'][_0x228f8c(0x91)]&&_0x22c335>=0x0&&_0x22c335<this[_0x228f8c(0x9b)][_0x228f8c(0xb2)][_0x228f8c(0xc0)]&&_0x4e429e>=0x1&&0x0===this[_0x228f8c(0x9b)][_0x228f8c(0x9d)][_0x27b135][_0x22c335]&&this['calcSum'](_0x27b135,_0x22c335)*_0x2474ab>=0x0;}['place'](_0x35f1be,_0x3f56bf,_0xb21623){const _0x19e763=a0_0x2295d9;_0x35f1be>0x0?(this[_0x19e763(0x9b)][_0x19e763(0xc4)][_0x19e763(0xb3)]--,this[_0x19e763(0x9b)]['grid'][_0x3f56bf][_0xb21623]=0x1):(this[_0x19e763(0x9b)][_0x19e763(0xc4)][_0x19e763(0xa7)]--,this[_0x19e763(0x9b)]['grid'][_0x3f56bf][_0xb21623]=-0x1);}}